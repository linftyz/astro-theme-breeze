---
import PostPreview from "@/components/blocks/PostPreview.astro";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";

export async function getStaticPaths() {
  const allCategories = await getCollection("categories");
  const allPosts = await getCollection("posts");

  return allCategories.map((cat) => {
    const filteredPosts = allPosts.filter(
      (post) => post.data.category.id === cat.id,
    );
    return {
      params: { slug: cat.data.slug },
      props: { category: cat, posts: filteredPosts },
    };
  });
}

const { category, posts } = Astro.props;
---

<Layout
  title={`Category: ${category.data.name}`}
  description={`${category.data.name}`}
>
  <div class="mx-auto max-w-2xl p-8 md:p-16">
    <header class="mb-16">
      <a
        href="/categories"
        class="mb-6 flex items-center gap-1 text-[10px] font-bold tracking-widest text-muted-foreground/60 uppercase transition-colors hover:text-primary"
      >
        <Icon name="mdi:arrow-left" size={14} /> Back
      </a>
      <h2 class="mb-4 text-3xl font-bold tracking-tight">
        <span class="text-primary">{category.data.name}</span>
      </h2>
      <p
        class="border-l-2 border-primary/20 py-1 pl-4 text-sm font-light text-muted-foreground italic"
      >
        {category.data.description}
      </p>
    </header>

    <div class="space-y-1">
      {posts.map((post) => <PostPreview post={post} />)}
    </div>
  </div>
</Layout>
