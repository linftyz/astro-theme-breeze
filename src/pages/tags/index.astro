---
import { getPosts } from "@/utils/post";
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const allTags = await getCollection("tags");
const allPosts = await getPosts();

// Count posts per tag
const tagCounts = allPosts.reduce((acc: Record<string, number>, post) => {
  post.data.tags.forEach((tagRef) => {
    acc[tagRef.id] = (acc[tagRef.id] || 0) + 1;
  });
  return acc;
}, {});
---

<Layout title="Tags" description="Browse all tags.">
  <div class="mx-auto max-w-2xl p-8 md:p-16">
    <header class="mb-16">
      <h2 class="mb-4 text-3xl font-bold">Tags</h2>
      <p class="mb-12 text-sm font-light text-muted-foreground italic">
        {allTags.length} tags in total.
      </p>
    </header>

    <div class="flex flex-wrap gap-4">
      {
        allTags.map((tag) => (
          <a
            href={`/tags/${tag.data.slug}`}
            class="group flex items-center gap-2 rounded-2xl border border-border/50 bg-muted/30 px-5 py-2.5 hover:border-primary/40 hover:bg-card"
          >
            <span class="text-muted-foreground italic group-hover:text-primary">
              #
            </span>
            <span class="text-sm font-medium text-foreground/80 group-hover:text-primary">
              {tag.data.name}
            </span>
            <span class="font-mono text-[10px] font-bold text-muted-foreground/40 group-hover:text-primary/60">
              {tagCounts[tag.data.slug] || 0}
            </span>
          </a>
        ))
      }
    </div>
  </div>
</Layout>
